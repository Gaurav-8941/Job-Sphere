<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Join Interview</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    body { background: #fafafa; }
    video {
        width: 80%;
        max-width: 550px;
        margin: auto;
        display: block;
        background: black;
        border-radius: 10px;
        box-shadow: 0px 0px 15px rgba(0,0,0,0.20);
    }
</style>
</head>
<body>

<div class="container text-center mt-5">
    <h3>Interview Room</h3>
    <p>Your interviewer will join shortly.</p>

    <video id="localVideo" autoplay muted playsinline></video>
    <video id="remoteVideo" autoplay playsinline class="mt-4"></video>

    <h5 id="status" class="text-success mt-3">Waiting for HR…</h5>
</div>

<script>
    const ws = new WebSocket("ws://" + window.location.host + "/ws/video");
    let pc = new RTCPeerConnection();

    ws.onmessage = async (event) => {
        const data = JSON.parse(event.data);

        if (data.type === "offer") {
            document.getElementById("status").innerText = "HR is calling you!";
            await pc.setRemoteDescription(new RTCSessionDescription(data));

            const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
            document.getElementById("localVideo").srcObject = stream;
            stream.getTracks().forEach(track => pc.addTrack(track, stream));

            const answer = await pc.createAnswer();
            await pc.setLocalDescription(answer);
            ws.send(JSON.stringify(answer));
        }

        if (data.type === "candidate") {
            pc.addIceCandidate(new RTCIceCandidate(data.candidate));
        }
    };

    pc.ontrack = (event) => {
        document.getElementById("remoteVideo").srcObject = event.streams[0];
        document.getElementById("status").innerText = "Connected ✔ Interview Live";
    };
</script>

</body>
</html>
