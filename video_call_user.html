<!DOCTYPE html>
<html>
<head>
    <title>Join Interview</title>
    <style>
        body { background:#f5f5f5; font-family:Arial; }
        #localVideo, #remoteVideo {
            width:45%;
            border-radius:12px;
            box-shadow:0 0 10px rgba(0,0,0,0.3);
        }
        #wrapper { display:flex; justify-content:space-evenly; margin-top:40px; }
        #info { text-align:center; margin-top:20px; }
        .btn { padding:12px 22px; background:#dc3545; color:white; border:none; border-radius:6px; }
    </style>
</head>
<body>

<h2 style="text-align:center;">Interview Video Call</h2>

<div id="wrapper">
    <video id="localVideo" autoplay muted></video>
    <video id="remoteVideo" autoplay></video>
</div>

<div id="info">
    <p>You are joining as <strong>Candidate</strong></p>
    <button class="btn" onclick="leaveCall()">Leave Call</button>
</div>
<script>
let peerConnection = new RTCPeerConnection();

// show local cam
navigator.mediaDevices.getUserMedia({ video: true, audio: true })
    .then(stream => {
        document.getElementById("localVideo").srcObject = stream;
        stream.getTracks().forEach(t => peerConnection.addTrack(t, stream));
    });

// show remote video
peerConnection.ontrack = (event) => {
    document.getElementById("remoteVideo").srcObject = event.streams[0];
};

let ws = new WebSocket(`ws://${window.location.host}/ws/user/{{ app_id }}`);

ws.onmessage = async (event) => {
    let data = JSON.parse(event.data);

    // HR started the call
    if (data.type === "call_start") {
        console.log("HR started call...");
        return;
    }

    // HR OFFER
    if (data.type === "offer") {
        await peerConnection.setRemoteDescription(data.offer);

        let answer = await peerConnection.createAnswer();
        await peerConnection.setLocalDescription(answer);

        ws.send(JSON.stringify({
            type: "answer",
            answer: answer
        }));
    }

    // HR ICE
    if (data.type === "ice") {
        if (data.candidate) {
            peerConnection.addIceCandidate(data.candidate);
        }
    }
};

</script>


</body>
</html>
